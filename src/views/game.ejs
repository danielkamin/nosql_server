<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gry</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link href="/css/styles.css" rel="stylesheet">
    <script src="/css/scripts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js" integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<script>
    async function addReview(){
        const data = document.querySelector("#review").value
        await axios.post('/review',{
                game:'<%= game._id %>',
                rating:data
        }).then(res=>{
            alert('Dodano ocenę')
            window.location.reload()
        }).catch(err=>{
            alert(err.response.data)
        })
    }
    async function removeReview(_id){
        await axios.post('/review/'+_id+'/usun').then(res=>{
            alert('Usunięto ocenę')
            window.location.reload()
        }).catch(err=>{
            alert(err.response.data)
        })
    }
</script>
<body>
    <%- include('functions.ejs') %>
    <body class="d-flex h-100 text-center text-white bg-dark">
        <main class="cover-container d-flex w-75 h-100 p-3 mx-auto flex-column justify-content-center align-items-center">
            <%- include('nav.ejs') %>
            <div class="shadow p-3 bg-dark-secondary w-50">
                <div class="mb-5 mt-2">
                    <h2><%= game.title %></h2>
                    <p class="lead"><%= game.studio %></p>
                </div> 
                <div class='d-flex flex-column align-items-start'>
                    <p class="">Data Premiery: <span class="text-action-secondary"><%= new Date(game.releaseDate).toLocaleDateString()%> </span></p>
                    <p class="">Średnia Ocena: 
                        <span  class="text-action-secondary">
                            <%if(game.avgRating!==null) {%>
                            <%= Math.round(game.avgRating.avgRating*100)/100%> /10
                            <%}else{%>
                            Brak danych
                            <%}%>
                        </span> 
                    </p>
                </div>
            </div>
            <div class="d-block w-25 text-center my-3">
                <label for="review" class="form-label">Ocena Gry</label>
                <input class="form-control bg-light w-50 mx-auto text-dark" type='number' min="0" max="10" id="review" name="review">
                <button onclick="addReview()" class="btn btn-light my-2">Dodaj</button>
            </div>
            <div class="">
                <% ratings.forEach(function(rating){%>
                    <div class="d-flex p-4 align-items-center">
                        <p class="fw-bold lead mx-2"><%= rating.rating%></p>
                        <p class="mx-2"><%= rating.user.userName%></p>
                        <%if(rating.user._id == cookie){%>
                        <p class="text-danger-secondary fw-bold mx-2" onclick="removeReview('<%=rating._id%>')">X</p>    
                        <%}%>
                    </div>                  
                <%});%>
            </div>
        </main>
    </body>
</body>
</html>

